<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Stylopia AR Video v7</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar-nft.js"></script>
    <style>
      html, body { margin:0; height:100%; background: transparent; overflow:hidden; }
      a-scene { width:100%; height:100%; }
      #videoPlane { opacity: 0; transition: opacity 1s ease-in-out; }
    </style>
  </head>
  <body>
    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;" renderer="antialias:true; colorManagement:true;">
      <a-assets>
        <video id="stylopiaVideo" src="assets/stylo.mp4" loop muted playsinline webkit-playsinline crossorigin="anonymous"></video>
      </a-assets>

      <!-- lighting -->
      <a-entity light="type: ambient; intensity: 1.0; color: #ffffff"></a-entity>
      <a-entity light="type: directional; intensity: 0.8; position: 1 2 2; color: #ffffff"></a-entity>

      <!-- Video plane (same size as previous image) -->
      <a-plane id="videoPlane" material="shader: flat; src: #stylopiaVideo; side: double; transparent: true"
               width="0.16" height="0.22" position="0 0.3 -1.5" rotation="0 0 0"></a-plane>

      <!-- soft shadow -->
      <a-circle id="shadow" radius="0.12" position="0 0 -1.5" rotation="-90 0 0" color="#000" opacity="0.25"></a-circle>

      <a-entity camera></a-entity>
    </a-scene>

    <script>
      const vid = document.getElementById('stylopiaVideo');
      const plane = document.getElementById('videoPlane');

      // Try to autoplay; if blocked, play on first user interaction
      function ensurePlay() {
        vid.play().then(()=>{
          // show plane when video starts
          plane.style.opacity = 1;
        }).catch((err)=>{
          // wait for a user gesture
          const resume = () => {
            vid.play().then(()=>{
              plane.style.opacity = 1;
              window.removeEventListener('touchstart', resume);
              window.removeEventListener('click', resume);
            }).catch(()=>{});
          };
          window.addEventListener('touchstart', resume, {once:true});
          window.addEventListener('click', resume, {once:true});
        });
      }

      // subtle float + slow rotation
      let t = 0;
      setInterval(()=>{
        t += 0.02;
        const y = 0.02 * Math.sin(t * 2);
        const rotY = 5 * Math.sin(t / 3);
        plane.object3D.position.y = 0.3 + y;
        plane.object3D.rotation.y = THREE.MathUtils.degToRad(rotY);
      }, 16);

      // when scene is ready, attempt play
      window.addEventListener('load', ()=>{
        // small timeout to allow ar.js init
        setTimeout(ensurePlay, 600);
      });
    </script>
  </body>
</html>
